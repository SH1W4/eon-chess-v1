<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêõ Debug da Base de Dados</title>
    <style>
        body {
            background: #171717;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .debug-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
        }

        .debug-section {
            margin: 20px 0;
            padding: 15px;
            background: #222;
            border-radius: 8px;
            border-left: 4px solid #00ff00;
        }

        .debug-button {
            background: linear-gradient(45deg, #00ff00, #00ffff);
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }

        .debug-button:hover {
            transform: scale(1.05);
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }

        .status.success {
            background: #004400;
            border: 1px solid #00ff00;
        }

        .status.error {
            background: #440000;
            border: 1px solid #ff0000;
        }

        .status.info {
            background: #004444;
            border: 1px solid #00ffff;
        }

        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: #000;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div class="debug-container">
        <h1>üêõ Debug da Base de Dados Pro</h1>

        <div class="debug-section">
            <h3>üìö Verifica√ß√£o da Base de Dados</h3>
            <button class="debug-button" onclick="checkDatabase()">üìö Verificar Base</button>
            <button class="debug-button" onclick="forceDatabaseInit()">üöÄ For√ßar Inicializa√ß√£o</button>
            <button class="debug-button" onclick="checkScripts()">üîç Verificar Scripts</button>
            <div id="database-status" class="status info">
                Aguardando verifica√ß√£o...
            </div>
        </div>

        <div class="debug-section">
            <h3>üîç Verifica√ß√£o de Scripts</h3>
            <div id="scripts-status" class="status info">
                Aguardando verifica√ß√£o...
            </div>
        </div>

        <div class="debug-section">
            <h3>üåê Verifica√ß√£o de Vari√°veis Globais</h3>
            <div id="globals-status" class="status info">
                Aguardando verifica√ß√£o...
            </div>
        </div>

        <div class="debug-section">
            <h3>üîç Logs do Sistema</h3>
            <div id="system-logs" class="log-container">
                Aguardando logs...
            </div>
            <button class="debug-button" onclick="clearLogs()">üßπ Limpar Logs</button>
        </div>
    </div>

    <!-- Carregar APENAS a base de dados primeiro -->
    <script src="js/chess-pro-database.js"></script>

    <script>
        // Sistema de logs
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('system-logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.className = `status ${type}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLogs() {
            document.getElementById('system-logs').innerHTML = 'Logs limpos...';
        }

        // Verificar base de dados
        function checkDatabase() {
            log('üìö Verificando base de dados...', 'info');
            const statusDiv = document.getElementById('database-status');

            if (window.chessProDB) {
                try {
                    const stats = window.chessProDB.getStatistics();
                    statusDiv.innerHTML = `
                        <strong>‚úÖ Base de Dados Ativa</strong><br>
                        Total de Posi√ß√µes: ${stats.totalPositions}<br>
                        Categorias: ${stats.totalCategories}<br>
                        Detalhes: ${JSON.stringify(stats.categories)}
                    `;
                    statusDiv.className = 'status success';
                    log('‚úÖ Base de dados Pro funcionando', 'success');
                    log(`üìä Estat√≠sticas: ${JSON.stringify(stats)}`, 'info');
                } catch (error) {
                    statusDiv.innerHTML = `<strong>‚ùå Erro na Base de Dados</strong><br>${error.message}`;
                    statusDiv.className = 'status error';
                    log(`‚ùå Erro na base de dados: ${error.message}`, 'error');
                }
            } else {
                statusDiv.innerHTML = '<strong>‚ùå Base de Dados N√£o Encontrada</strong>';
                statusDiv.className = 'status error';
                log('‚ùå Base de dados Pro n√£o encontrada', 'error');
            }
        }

        // For√ßar inicializa√ß√£o da base de dados
        function forceDatabaseInit() {
            log('üöÄ For√ßando inicializa√ß√£o da base de dados...', 'info');

            if (window.ChessProDatabase) {
                try {
                    window.chessProDB = new window.ChessProDatabase();
                    log('‚úÖ Base de dados criada manualmente', 'success');

                    // Verificar novamente
                    setTimeout(() => {
                        checkDatabase();
                    }, 500);
                } catch (error) {
                    log(`‚ùå Erro ao criar base de dados: ${error.message}`, 'error');
                }
            } else {
                log('‚ùå Classe ChessProDatabase n√£o encontrada', 'error');
            }
        }

        // Verificar scripts
        function checkScripts() {
            log('üîç Verificando scripts...', 'info');
            const statusDiv = document.getElementById('scripts-status');

            const scripts = [
                'chess-pro-database.js'
            ];

            const loadedScripts = [];
            const missingScripts = [];

            scripts.forEach(script => {
                const scriptElement = document.querySelector(`script[src*="${script}"]`);
                if (scriptElement) {
                    loadedScripts.push(script);
                    log(`‚úÖ Script ${script} carregado`, 'success');
                } else {
                    missingScripts.push(script);
                    log(`‚ùå Script ${script} n√£o encontrado`, 'error');
                }
            });

            if (loadedScripts.length === scripts.length) {
                statusDiv.innerHTML = '<strong>‚úÖ Todos os scripts carregados</strong>';
                statusDiv.className = 'status success';
            } else {
                statusDiv.innerHTML = `<strong>‚ùå Scripts faltando</strong><br>Carregados: ${loadedScripts.join(', ')}<br>Faltando: ${missingScripts.join(', ')}`;
                statusDiv.className = 'status error';
            }
        }

        // Verificar vari√°veis globais
        function checkGlobals() {
            log('üåê Verificando vari√°veis globais...', 'info');
            const statusDiv = document.getElementById('globals-status');

            const globals = [
                'ChessProDatabase',
                'chessProDB'
            ];

            const availableGlobals = [];
            const missingGlobals = [];

            globals.forEach(globalName => {
                if (window[globalName]) {
                    availableGlobals.push(globalName);
                    log(`‚úÖ Vari√°vel global ${globalName} dispon√≠vel`, 'success');
                } else {
                    missingGlobals.push(globalName);
                    log(`‚ùå Vari√°vel global ${globalName} n√£o dispon√≠vel`, 'error');
                }
            });

            if (availableGlobals.length === globals.length) {
                statusDiv.innerHTML = '<strong>‚úÖ Todas as vari√°veis globais dispon√≠veis</strong>';
                statusDiv.className = 'status success';
            } else {
                statusDiv.innerHTML = `<strong>‚ùå Vari√°veis globais faltando</strong><br>Dispon√≠veis: ${availableGlobals.join(', ')}<br>Faltando: ${missingGlobals.join(', ')}`;
                statusDiv.className = 'status error';
            }
        }

        // Verificar inicializa√ß√£o
        function checkInitialization() {
            log('üîç Verificando inicializa√ß√£o...', 'info');

            // Verificar se a base de dados foi inicializada
            if (window.chessProDB) {
                log('‚úÖ Base de dados inicializada automaticamente', 'success');
            } else {
                log('‚ùå Base de dados n√£o inicializada automaticamente', 'error');

                // Verificar se a classe existe
                if (window.ChessProDatabase) {
                    log('‚úÖ Classe ChessProDatabase encontrada', 'success');
                    log('üîß Tentando inicializa√ß√£o manual...', 'info');

                    try {
                        window.chessProDB = new window.ChessProDatabase();
                        log('‚úÖ Base de dados inicializada manualmente', 'success');
                    } catch (error) {
                        log(`‚ùå Erro na inicializa√ß√£o manual: ${error.message}`, 'error');
                    }
                } else {
                    log('‚ùå Classe ChessProDatabase n√£o encontrada', 'error');
                }
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina de debug carregada', 'success');

            // Verificar scripts primeiro
            setTimeout(() => {
                checkScripts();
            }, 500);

            // Verificar vari√°veis globais
            setTimeout(() => {
                checkGlobals();
            }, 1000);

            // Verificar inicializa√ß√£o
            setTimeout(() => {
                checkInitialization();
                checkDatabase();
            }, 2000);
        });

        // Verifica√ß√£o peri√≥dica
        setInterval(() => {
            if (!window.chessProDB) {
                log('‚ö†Ô∏è Base de dados ainda n√£o dispon√≠vel, tentando novamente...', 'info');
                checkInitialization();
            }
        }, 5000);
    </script>
</body>

</html>